# ğŸ§  Neuro-Lie-Detector: EEG-Based Truth and Deception Classifier  

## 1ï¸âƒ£ Introduction  

The goal of this project is the **analysis of electroencephalographic (EEG) data** to develop a **machine learning model** capable of distinguishing whether a study participant is telling the truth or **deliberately lying**.  

The project is based on an experimental paradigm inspired by the **Concealed Information Test (CIT)**.  
In this approach, brain responses to personally relevant stimuli are analyzed to detect so-called **â€œguilty knowledgeâ€**, i.e., deliberate deception.  

For EEG signal processing and analysis, the following tools were used:  
- ğŸ“¦ **mne-python** â€“ for EEG signal preprocessing and filtering,  
- ğŸŒ² **scikit-learn (Random Forest)** â€“ to build a classifier distinguishing between â€œtruthâ€ and â€œlieâ€ states.  

---

## 2ï¸âƒ£ Conceptual Overview  

### âš¡ Electroencephalography (EEG)  

**EEG** is a non-invasive method for measuring the brainâ€™s electrical activity using electrodes placed on the scalp.  
It records the cumulative **postsynaptic potentials** generated by neurons, allowing the analysis of brain states **in real time** with high temporal resolution.  

---

# ğŸ” 2ï¸âƒ£ Conceptual Overview: ERP, P300, and Research Findings   

---

## ğŸ§© 2.1. Event-Related Potentials (ERP) and the P300 Wave  

**Event-Related Potentials (ERP)** are measurable changes in the EEG signal that represent the brainâ€™s **direct response to a specific, discrete stimulus**  
(e.g., the presentation of a question, image, or sound).  
ERP analysis enables tracking of cognitive processes with **millisecond precision**, making it one of the most powerful tools in cognitive neuroscience.  

---

### âš¡ The P300 (P3b) Wave â€” The Key to Detecting Deception  

The **P300** (or **P3b**) wave is one of the most extensively studied ERP components. It is characterized by:  

- ğŸ”º A **positive peak** in the EEG signal, appearing approximately **300â€“600 ms after stimulus onset**.  
- ğŸ§  A **link to cognitive processes** such as **stimulus evaluation** and **working memory updating**.  
- ğŸ“ˆ **Higher amplitude** in response to stimuli that are **rare, unexpected, or personally significant**,  
  such as oneâ€™s own name, date of birth, or familiar faces.  

> ğŸ’¡ **In the context of lie detection:**  
> The P300 wave is considered a **neurological marker of recognition**, even when the subject attempts to conceal their knowledge.  

---

## ğŸ“Š 2.2. Hypothesis vs. Actual Findings (EDA)  

### ğŸ§ª Classical Hypothesis  
The standard hypothesis in **CIT (Concealed Information Test)** research assumes that:  
> ğŸ‘‰ A significant stimulus (e.g., true personal information) elicits a **stronger P300 response**,  
> regardless of whether the participant is **telling the truth** or **deliberately lying**.  

---

### ğŸ“ˆ Findings from Exploratory Data Analysis (EDA)  

Within this project, an **Exploratory Data Analysis (EDA)** was conducted â€” detailed in the notebook  
ğŸ““ *`eda_presentation.ipynb`*.  


Analysis of **Global Field Power (GFP)** â€” a measure of the overall strength of EEG activity â€” revealed **striking gender differences**:  

#### ğŸ‘¨ In Men  
- A distinct **GFP peak** was observed during **truth-telling** (e.g., confirming oneâ€™s true identity).  
- The response to **deliberate deception** was **significantly weaker**.  

#### ğŸ‘© In Women  
- The pattern was **reversed** â€” a strong **GFP peak** appeared **during lying**.  
- Truth-telling produced a **flatter and more stable response**.  

---

## ğŸ§  Key Findings and Implications  

This discovery has **critical implications for model development**.  
Since EEG response patterns differ **fundamentally between genders**,  
a **â€œone-model-fits-allâ€** approach proves **inefficient**.  

Therefore, the repository includes a dedicated testing script:  
ğŸ“„ **`model_females_only.py`**  
â¡ï¸ It trains a classifier **exclusively on female participants**,  
to determine whether the model can capture the **specific neural pattern associated with deception**  
and whether this improves overall accuracy.  

---

ğŸ“˜ *Summary:*  
The experiment revealed that **participant gender** significantly influences the neural signatures of truth and deception â€”  
opening new directions for research in **the neuropsychology of lying** and **personalized EEG-based modeling**.  

---

### ğŸ“Š Power Spectral Density (PSD)  

**PSD** describes how the energy of the EEG signal is distributed across different **frequency bands**.  
PSD analysis allows us to assess whether **lying** and **truth-telling** involve distinct activity levels in certain bands:  

| Band | Range (Hz) | Neurophysiological Significance |
|:------|:------------:|:-------------------------------|
| **Theta** | 4â€“8 | Memory processes, focused attention |
| **Alpha** | 8â€“13 | Relaxation, inhibition of irrelevant information |
| **Beta** | 13â€“30 | Active thinking, stress, concentration |

In this project, the **input features for the AI model** are defined as the **average signal power** within these frequency bands.

---

```mermaid
graph TD
    subgraph Men
        M_Truth[Telling the Truth]
        M_Lie[Deliberate Lie]
        M_Peak[High GFP Peak]
        M_Low[Low/Normal GFP Activity]
    end
    
    subgraph Women
        W_Lie[Deliberate Lie]
        W_Truth[Telling the Truth]
        W_Peak[High GFP Peak]
        W_Low[Low/Normal GFP Activity]
    end

    %% Connections
    M_Truth --> M_Peak
    M_Lie --> M_Low
    
    W_Lie --> W_Peak
    W_Truth --> W_Low
```

# âš™ï¸ 3ï¸âƒ£ Project Description and Workflow  

---

## ğŸ§  3.1. Experimental Paradigm  

In the experiment, participants were presented with a **series of cognitive tasks** where they were asked to **confirm or deny** displayed personal information (e.g., name, surname, date of birth).  
Each task required a **â€œYesâ€** or **â€œNoâ€** response, where the meaning of **truth or deception** depended on the context of a given block.  

The experiment was divided into **four main blocks**, differing in the relationship between the stimulus and the expected response:  

| ğŸ”¢ **Block** | ğŸ§© **Task Description** | ğŸ’¬ **Required Response** | ğŸ§  **Expected State** |
|:------------:|:----------------------:|:------------------------:|:--------------------:|
| **Block 1** | Presentation of **true personal data** | â€œYesâ€ (confirmation) | âœ… **TRUTH** |
| **Block 2** | Presentation of **true personal data** | â€œNoâ€ (denial) | âŒ **LIE** |
| **Block 3** | Presentation of **false identity data** | â€œYesâ€ (confirmation) | âŒ **LIE** |
| **Block 4** | Presentation of **false identity data** | â€œNoâ€ (denial) | âœ… **TRUTH** |

---

### ğŸ’¾ Data Structure  

The collected EEG data were preprocessed and saved in **`.fif` format**,  
including labels that describe the participantâ€™s cognitive state during each task:  

- ğŸŸ¢ **HONEST** â†’ responses consistent with the truth (Blocks **1** and **4**)  
- ğŸ”´ **DECEITFUL** â†’ false responses, i.e., deliberate lies (Blocks **2** and **3**)  

> ğŸ’¡ This labeling allows for quick grouping of trials based on the participantâ€™s cognitive condition even at the raw data stage.  

---

## ğŸ”„ 3.2. Data Processing Pipeline  

The entire EEG analysis process â€” from raw signal to AI model prediction â€” has been **fully automated**.  
The processing pipeline includes the following stages:  

1. ğŸ§¹ **Loading and Cleaning EEG Data**  
   - Removal of artifacts (e.g., eye blinks, eye movements)  
   - Band-pass filtering (e.g., 1â€“40 Hz)  

2. âš™ï¸ **Data Segmentation (Epoching)**  
   - Splitting continuous EEG signals into short segments corresponding to individual stimuli  

3. ğŸ“Š **Feature Extraction**  
   - Calculation of **Power Spectral Density (PSD)** for **Theta**, **Alpha**, and **Beta** frequency bands  
   - Computing average power values for each EEG channel  

4. ğŸ¤– **Training the Classification Model**  
   - Using a **Random Forest** algorithm to distinguish between **HONEST** and **DECEITFUL** states  

5. ğŸ” **Validation and Evaluation**  
   - Calculating accuracy, confusion matrix, and ROC curve  
   - Comparing results across groups (e.g., gender, EEG channels, frequency bands)  

---


```mermaid
graph TD
    A[Raw EEG Data .fif] --> B(Preprocessing);
    B --> C(Epoching);
    C --> D(Feature Extraction);
    D --> E(Model Training);
    E --> F(Evaluation);

    subgraph B [Preprocessing preprocessing.py]
        B1[Bandpass filtering 1-40 Hz]
        B2[EEG channels only selection]
        B3[Set standard_1020 montage]
    end

    subgraph C [Epoching epoching.py]
        C1[Data segmentation around stimuli]
        C2[Time window: -0.2s to +0.8s relative to stimulus]
    end

    subgraph D [Feature Extraction feature_extraction.py]
        D1[PSD calculation using Welch's method]
        D2[Average power in Theta, Alpha, Beta bands]
        D3[Create feature matrix X]
    end

    subgraph E [Model Training final_model_*.py]
        E1[Define labels 'y' Honest=0, Deceitful=1]
        E2[Feature scaling StandardScaler]
        E3[RandomForestClassifier]
    end

    subgraph F [Evaluation]
        F1[Cross-validation]
        F2[Train/Validation/Test split]
        F3[Confusion matrix and Classification report]
    end
```
ğŸ“˜ *Summary:*  
The experimental section combines a **tightly controlled cognitive paradigm** with an **advanced EEG processing pipeline**,  
enabling automated classification of brain responses into **truth** and **lie** categories.  

---

## 4. Repository Structure

```
â”œâ”€â”€ dataset/                  # (Required locally) Folder for raw EEG data (.fif)
â”œâ”€â”€ src/                      # Python modules containing data processing logic
â”‚   â”œâ”€â”€ analysys_utils.py     # Utility functions for data loading and analysis
â”‚   â”œâ”€â”€ epoching.py           # Script for epoch creation (data segmentation)
â”‚   â”œâ”€â”€ feature_extraction.py # Script for PSD feature extraction
â”‚   â””â”€â”€ preprocessing.py      # Script for initial data cleaning
â”œâ”€â”€ notebooks/ 
â”‚   â””â”€â”€ eda_presentation.ipynb    # Jupyter Notebook for Exploratory Data Analysis (EDA)
â”œâ”€â”€ final_model_both.py       # Main script: trains model on all participants (Train/Val/Test split)
â”œâ”€â”€ final_model_cv.py         # Main script: trains model on all participants using Cross-Validation (CV)
â”œâ”€â”€ model_females_only.py     # Script for training a model on female participants only (based on EDA findings)
â””â”€â”€ requirements.txt          # List of Python dependencies
```

---

# ğŸ§© 5ï¸âƒ£ Installation and Execution  

## âš™ï¸ 5.1. Prerequisites  

Before you begin, make sure you have the following installed:  

- ğŸ **Python 3.8+**  
- ğŸ”§ **Git**  

## ğŸš€ 5.2. Installation Steps  

1.  Clone the repository:  
    ```bash
    git clone https://github.com/xVarmondx/neuro-lie-detector.git
    cd neuro-lie-detector
    ```

2.  Create and activate a virtual environment:  
    ```bash
    python -m venv venv

    # Na Linux/MacOS
    source venv/bin/activate

    # Na Windows:
    venv\Scripts\activate
    ```

3.  Install the required libraries:  
    ```bash
    pip install -r requirements.txt
    ```

### 4ï¸âƒ£ ğŸ”‘ **Key Step: Data Preparation**

For the project to function properly, you must **manually download the EEG experimental data**.  

---

#### ğŸ“¥ Downloading the Data  

1. Create a **`dataset/`** folder in the projectâ€™s root directory (`neuro-lie-detector/`).  
2. Inside the `dataset/` folder, create **subfolders** for each participant,  
   named with their unique **UUID**.  
3. Upload the corresponding `.fif` EEG data files into each participantâ€™s subfolder.  

ğŸ“ **Data Link:**  
[Google Drive â€“ Neuro-Lie-Detector Dataset](https://drive.google.com/file/d/18YR2hdIq5lfktockpFT0PkXopX3kyM7U/view)  

ğŸ’¡ **Alternatively:**  
You can download the dataset from my **`old`** branch if the files are already organized there.  

---

#### ğŸ—‚ï¸ Required Directory Structure  

    ```
    neuro-lie-detector/
    â”œâ”€â”€ dataset/
    â”‚   â”œâ”€â”€ 2D663E30/                  # Example participant folder (UUID)
    â”‚   â”‚   â”œâ”€â”€ ...HONEST..._raw.fif   # EEG data â€” truthful responses
    â”‚   â”‚   â””â”€â”€ ...DECEITFUL..._raw.fif# EEG data â€” deceptive responses
    â”‚   â”œâ”€â”€ A511.../                   # Another participant
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â””â”€â”€ Ankiety.xlsx               # Optional: questionnaire file (used in model_females_only.py)
    â”‚
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ preprocessing.py           # EEG preprocessing script
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ final_model_both.py            # Main model training script (all participants)
    â””â”€â”€ requirements.txt               # Python dependencies
    ```

#### â–¶ï¸ 1ï¸âƒ£ Training with Cross-Validation *(all participants)*  

**ğŸ§© What it does:**  
Processes EEG data from **all participants** and performs **5-fold cross-validation**,  
allowing you to assess the modelâ€™s **stability, overall accuracy, and resistance to overfitting**.  

**ğŸ’» How to run:**  
        ```bash
        python final_model_cv.py
        ```

### â–¶ï¸ 2ï¸âƒ£ Training with Train/Validation/Test Split *(all participants)*  

**ğŸ§© What it does:**  
Uses a **fixed data split**:  
- ğŸ§  **70%** â€“ training data,  
- ğŸ§ª **15%** â€“ validation data,  
- ğŸ§¾ **15%** â€“ test data.  

The model is trained on the full set of participants to create **a single final classifier**,  
which can later be used for predicting new EEG data.  

**ğŸ’» How to run:**  
        ```bash
        python final_model_both.py
        ```

#### â–¶ï¸ 3ï¸âƒ£ Training a Model for Female Participants Only *(based on EDA)*  

**ğŸ§© What it does:**  
Loads the **`Ankiety.xlsx`** file located in the `dataset/` folder,  
then **filters female participants** and trains the model exclusively on this subset of data.  

This approach is based on findings from the **Exploratory Data Analysis (EDA)**,  
which revealed significant gender differences in brain activity  
during truth-telling and lying.  

**ğŸ’» How to run:**  
```bash
python model_females_only.py
```

### ğŸ“Š 5.4. Exploratory Data Analysis (EDA)  

To perform a detailed analysis of EEG signals, including:  
- Visualizations of **ERP waves (Event-Related Potentials)**,  
- Topographic brain activity maps (**topomaps**),  
- Comparisons between **HONEST** and **DECEITFUL** conditions,  

launch the Jupyter Notebook from the projectâ€™s root directory.

---

#### â–¶ï¸ 1ï¸âƒ£ Starting the Jupyter Server  

In your terminal (from the `neuro-lie-detector/` directory), run:  
```bash
jupyter lab
```

If your browser does not open automatically, the console will display an address to copy.

```bash
http://localhost:8888/?token=... (a very long string of characters)
```

OR

```bash
http://127.0.0.1:8888/?token=... (a very long string of characters)
```

1. Copy one of these links â€” the entire URL, including `?token=...`  
2. Paste it into your browser's address bar and press Enter.  

This will open the Jupyter dashboard. From there, you can click the `notebooks` folder, and then open the file `eda_presentation.ipynb`.


ğŸ“˜ *Summary:*  
The **Neuro-Lie-Detector** project combines EEG analysis, signal processing, and machine learning to objectively study brain responses associated with **lying and truth-telling**.

